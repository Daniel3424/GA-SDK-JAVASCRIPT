var CryptoJS=CryptoJS||function(e,n){var t={},i=t.lib={},s=function(){},r=i.Base={extend:function(e){s.prototype=this;var n=new s;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=n?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var n=this.words,t=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var s=0;s<e;s++)n[i+s>>>2]|=(t[s>>>2]>>>24-8*(s%4)&255)<<24-8*((i+s)%4);else if(65535<t.length)for(s=0;s<e;s+=4)n[i+s>>>2]=t[s>>>2];else n.push.apply(n,t);return this.sigBytes+=e,this},clamp:function(){var n=this.words,t=this.sigBytes;n[t>>>2]&=4294967295<<32-8*(t%4),n.length=e.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(n){for(var t=[],i=0;i<n;i+=4)t.push(4294967296*e.random()|0);return new o.init(t,n)}}),a=t.enc={},u=a.Hex={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],i=0;i<e;i++){var s=n[i>>>2]>>>24-8*(i%4)&255;t.push((s>>>4).toString(16)),t.push((15&s).toString(16))}return t.join("")},parse:function(e){for(var n=e.length,t=[],i=0;i<n;i+=2)t[i>>>3]|=parseInt(e.substr(i,2),16)<<24-4*(i%8);return new o.init(t,n/2)}},c=a.Latin1={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],i=0;i<e;i++)t.push(String.fromCharCode(n[i>>>2]>>>24-8*(i%4)&255));return t.join("")},parse:function(e){for(var n=e.length,t=[],i=0;i<n;i++)t[i>>>2]|=(255&e.charCodeAt(i))<<24-8*(i%4);return new o.init(t,n)}},d=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=i.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(n){var t=this._data,i=t.words,s=t.sigBytes,r=this.blockSize,a=s/(4*r),a=n?e.ceil(a):e.max((0|a)-this._minBufferSize,0);if(n=a*r,s=e.min(4*n,s),n){for(var u=0;u<n;u+=r)this._doProcessBlock(i,u);u=i.splice(0,n),t.sigBytes-=s}return new o.init(u,s)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=l.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(n,t){return new e.init(t).finalize(n)}},_createHmacHelper:function(e){return function(n,t){return new f.HMAC.init(e,t).finalize(n)}}});var f=t.algo={};return t}(Math);!function(e){for(var n=CryptoJS,t=n.lib,i=t.WordArray,s=t.Hasher,t=n.algo,r=[],o=[],a=function(e){return 4294967296*(e-(0|e))|0},u=2,c=0;64>c;){var d;e:{d=u;for(var l=e.sqrt(d),f=2;f<=l;f++)if(!(d%f)){d=!1;break e}d=!0}d&&(8>c&&(r[c]=a(e.pow(u,.5))),o[c]=a(e.pow(u,1/3)),c++),u++}var v=[],t=t.SHA256=s.extend({_doReset:function(){this._hash=new i.init(r.slice(0))},_doProcessBlock:function(e,n){for(var t=this._hash.words,i=t[0],s=t[1],r=t[2],a=t[3],u=t[4],c=t[5],d=t[6],l=t[7],f=0;64>f;f++){if(16>f)v[f]=0|e[n+f];else{var g=v[f-15],m=v[f-2];v[f]=((g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3)+v[f-7]+((m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10)+v[f-16]}g=l+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&d)+o[f]+v[f],m=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&s^i&r^s&r),l=d,d=c,c=u,u=a+g|0,a=r,r=s,s=i,i=g+m|0}t[0]=t[0]+i|0,t[1]=t[1]+s|0,t[2]=t[2]+r|0,t[3]=t[3]+a|0,t[4]=t[4]+u|0,t[5]=t[5]+c|0,t[6]=t[6]+d|0,t[7]=t[7]+l|0},_doFinalize:function(){var n=this._data,t=n.words,i=8*this._nDataBytes,s=8*n.sigBytes;return t[s>>>5]|=128<<24-s%32,t[(s+64>>>9<<4)+14]=e.floor(i/4294967296),t[(s+64>>>9<<4)+15]=i,n.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=s._createHelper(t),n.HmacSHA256=s._createHmacHelper(t)}(Math),function(){var e=CryptoJS,n=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var i=e.blockSize,s=4*i;t.sigBytes>s&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),o=this._iKey=t.clone(),a=r.words,u=o.words,c=0;c<i;c++)a[c]^=1549556828,u[c]^=909522486;r.sigBytes=o.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var n=this._hasher;return e=n.finalize(e),n.reset(),n.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=CryptoJS,n=e.lib.WordArray;e.enc.Base64={stringify:function(e){var n=e.words,t=e.sigBytes,i=this._map;e.clamp(),e=[];for(var s=0;s<t;s+=3)for(var r=(n[s>>>2]>>>24-8*(s%4)&255)<<16|(n[s+1>>>2]>>>24-8*((s+1)%4)&255)<<8|n[s+2>>>2]>>>24-8*((s+2)%4)&255,o=0;4>o&&s+.75*o<t;o++)e.push(i.charAt(r>>>6*(3-o)&63));if(n=i.charAt(64))for(;e.length%4;)e.push(n);return e.join("")},parse:function(e){var t=e.length,i=this._map,s=i.charAt(64);s&&(s=e.indexOf(s),-1!=s&&(t=s));for(var s=[],r=0,o=0;o<t;o++)if(o%4){var a=i.indexOf(e.charAt(o-1))<<2*(o%4),u=i.indexOf(e.charAt(o))>>>6-2*(o%4);s[r>>>2]|=(a|u)<<24-8*(r%4),r++}return n.create(s,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}();var ga;!function(e){var n;!function(e){e[e.Undefined=0]="Undefined",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical"}(n=e.EGAErrorSeverity||(e.EGAErrorSeverity={}));var t;!function(e){e[e.Undefined=0]="Undefined",e[e.Male=1]="Male",e[e.Female=2]="Female"}(t=e.EGAGender||(e.EGAGender={}));var i;!function(e){e[e.Undefined=0]="Undefined",e[e.Start=1]="Start",e[e.Complete=2]="Complete",e[e.Fail=3]="Fail"}(i=e.EGAProgressionStatus||(e.EGAProgressionStatus={}));var s;!function(e){e[e.Undefined=0]="Undefined",e[e.Source=1]="Source",e[e.Sink=2]="Sink"}(s=e.EGAResourceFlowType||(e.EGAResourceFlowType={}));var r;!function(e){var n;!function(e){e[e.Undefined=0]="Undefined",e[e.Rejected=1]="Rejected"}(n=e.EGASdkErrorType||(e.EGASdkErrorType={}));var t;!function(e){e[e.NoResponse=0]="NoResponse",e[e.BadResponse=1]="BadResponse",e[e.RequestTimeout=2]="RequestTimeout",e[e.JsonEncodeFailed=3]="JsonEncodeFailed",e[e.JsonDecodeFailed=4]="JsonDecodeFailed",e[e.InternalServerError=5]="InternalServerError",e[e.BadRequest=6]="BadRequest",e[e.Unauthorized=7]="Unauthorized",e[e.UnknownResponseCode=8]="UnknownResponseCode",e[e.Ok=9]="Ok"}(t=e.EGAHTTPApiResponse||(e.EGAHTTPApiResponse={}))}(r=e.http||(e.http={}))}(ga||(ga={}));var ga;!function(e){var n;!function(e){var n;!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Debug=3]="Debug"}(n||(n={}));var t=function(){function e(){e.debugEnabled=!1}return e.setInfoLog=function(n){e.instance.infoLogEnabled=n},e.setVerboseLog=function(n){e.instance.infoLogVerboseEnabled=n},e.i=function(t){if(e.instance.infoLogEnabled){var i="Info/"+e.Tag+": "+t;e.instance.sendNotificationMessage(i,n.Info)}},e.w=function(t){var i="Warning/"+e.Tag+": "+t;e.instance.sendNotificationMessage(i,n.Warning)},e.e=function(t){var i="Error/"+e.Tag+": "+t;e.instance.sendNotificationMessage(i,n.Error)},e.ii=function(t){if(e.instance.infoLogVerboseEnabled){var i="Verbose/"+e.Tag+": "+t;e.instance.sendNotificationMessage(i,n.Info)}},e.d=function(t){if(e.debugEnabled){var i="Debug/"+e.Tag+": "+t;e.instance.sendNotificationMessage(i,n.Debug)}},e.prototype.sendNotificationMessage=function(e,t){switch(t){case n.Error:console.error(e);break;case n.Warning:console.warn(e);break;case n.Debug:"function"==typeof console.debug?console.debug(e):console.log(e);break;case n.Info:console.log(e)}},e}();t.instance=new t,t.Tag="GameAnalytics",e.GALogger=t}(n=e.logging||(e.logging={}))}(ga||(ga={}));var ga;!function(e){var n;!function(n){var t=e.logging.GALogger,i=function(){function e(){}return e.getHmac=function(e,n){var t=CryptoJS.HmacSHA256(n,e);return CryptoJS.enc.Base64.stringify(t)},e.stringMatch=function(e,n){return!(!e||!n)&&n.test(e)},e.joinStringArray=function(e,n){for(var t="",i=0,s=e.length;i<s;i++)i>0&&(t+=n),t+=e[i];return t},e.stringArrayContainsString=function(e,n){if(0===e.length)return!1;for(var t in e)if(e[t]===n)return!0;return!1},e.encode64=function(n){n=encodeURI(n);var t,i,s,r,o,a="",u=0,c=0,d=0;do t=n.charCodeAt(d++),i=n.charCodeAt(d++),u=n.charCodeAt(d++),s=t>>2,r=(3&t)<<4|i>>4,o=(15&i)<<2|u>>6,c=63&u,isNaN(i)?o=c=64:isNaN(u)&&(c=64),a=a+e.keyStr.charAt(s)+e.keyStr.charAt(r)+e.keyStr.charAt(o)+e.keyStr.charAt(c),t=i=u=0,s=r=o=c=0;while(d<n.length);return a},e.decode64=function(n){var i,s,r,o,a,u="",c=0,d=0,l=0,f=/[^A-Za-z0-9\+\/\=]/g;f.exec(n)&&t.w("There were invalid base64 characters in the input text. Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='. Expect errors in decoding."),n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=e.keyStr.indexOf(n.charAt(l++)),o=e.keyStr.indexOf(n.charAt(l++)),a=e.keyStr.indexOf(n.charAt(l++)),d=e.keyStr.indexOf(n.charAt(l++)),i=r<<2|o>>4,s=(15&o)<<4|a>>2,c=(3&a)<<6|d,u+=String.fromCharCode(i),64!=a&&(u+=String.fromCharCode(s)),64!=d&&(u+=String.fromCharCode(c)),i=s=c=0,r=o=a=d=0;while(l<n.length);return decodeURI(u)},e.timeIntervalSince1970=function(){var e=new Date;return Math.round(e.getTime()/1e3)},e.createGuid=function(){return(e.s4()+e.s4()+"-"+e.s4()+"-4"+e.s4().substr(0,3)+"-"+e.s4()+"-"+e.s4()+e.s4()+e.s4()).toLowerCase()},e.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e}();i.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n.GAUtilities=i}(n=e.utilities||(e.utilities={}))}(ga||(ga={}));var ga;!function(e){var n;!function(e){var n=function(){function e(){}return e.validateBusinessEvent=function(e,n,t,i,s){return!0},e.validateResourceEvent=function(e,n,t,i,s,r,o){return!0},e.validateProgressionEvent=function(e,n,t,i){return!0},e.validateDesignEvent=function(e,n){return!0},e.validateErrorEvent=function(e,n){return!0},e.validateSdkErrorEvent=function(e,n,t){return!0},e.validateKeys=function(e,n){return!0},e.validateCurrency=function(e){return!0},e.validateEventPartLength=function(e,n){return!0},e.validateEventPartCharacters=function(e){return!0},e.validateEventIdLength=function(e){return!0},e.validateEventIdCharacters=function(e){return!0},e.validateAndCleanInitRequestResponse=function(e){return e},e.validateBuild=function(e){return!0},e.validateSdkWrapperVersion=function(e){return!0},e.validateEngineVersion=function(e){return!0},e.validateUserId=function(e){return!0},e.validateShortString=function(e,n){return!0},e.validateString=function(e,n){return!0},e.validateLongString=function(e,n){return!0},e.validateConnectionType=function(e){return!0},e.validateCustomDimensions=function(e){return!0},e.validateResourceCurrencies=function(e){return!0},e.validateResourceItemTypes=function(e){return!0},e.validateDimension01=function(e,n){return!0},e.validateDimension02=function(e,n){return!0},e.validateDimension03=function(e,n){return!0},e.validateArrayOfStrings=function(e,n,t,i,s){return!0},e.validateFacebookId=function(e){return!0},e.validateGender=function(e){return!0},e.validateBirthyear=function(e){return!0},e.validateClientTs=function(e){return!0},e}();e.GAValidator=n}(n=e.validators||(e.validators={}))}(ga||(ga={}));var ga;!function(e){var n;!function(e){var n=function(){function e(e,n,t){this.name=e,this.value=n,this.version=t}return e}();e.NameValueVersion=n;var t=function(){function e(e,n){this.name=e,this.version=n}return e}();e.NameVersion=t;var i=function(){function e(){}return e.touch=function(){},e.getRelevantSdkVersion=function(){return e.sdkGameEngineVersion?e.sdkGameEngineVersion:e.sdkWrapperVersion},e.getConnectionType=function(){return e.connectionType},e.updateConnectionType=function(){navigator.onLine?"ios"===e.buildPlatform||"android"===e.buildPlatform?e.connectionType="wwan":e.connectionType="lan":e.connectionType="offline"},e.getOSVersionString=function(){return e.buildPlatform+" "+e.osVersionPair.version},e.runtimePlatformToString=function(){return e.osVersionPair.name},e.getBrowserVersionString=function(){var e,n=navigator.userAgent,t=n.match(/(opera|chrome|safari|firefox|ubrowser|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(t[1]))return e=/\brv[ :]+(\d+)/g.exec(n)||[],"IE "+(e[1]||"");if("Chrome"===t[1]&&(e=n.match(/\b(OPR|Edge|UBrowser)\/(\d+)/),null!=e))return e.slice(1).join(" ").replace("OPR","Opera").replace("UBrowser","UC").toLowerCase();var i=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!=(e=n.match(/version\/(\d+)/i))&&i.splice(1,1,e[1]),i.join(" ").toLowerCase()},e.getDeviceModel=function(){var e="unknown";return e},e.getDeviceManufacturer=function(){var e="unknown";return e},e.matchItem=function(e,n){console.log("AGENT: "+e);var i,s,r,o,a,u,c=new t("unknown","0.0.0"),d=0,l=0;for(d=0;d<n.length;d+=1)if(i=new RegExp(n[d].value,"i"),r=i.test(e)){if(s=new RegExp(n[d].version+"[- /:;]([\\d._]+)","i"),o=e.match(s),u="",o&&o[1]&&(a=o[1]),a){var f=a.split(/[._]+/);for(l=0;l<Math.min(f.length,3);l+=1)u+=f[l]+(l<Math.min(f.length,3)-1?".":"")}else u="0.0.0";return c.name=n[d].name,c.version=u,c}return c},e}();i.sdkWrapperVersion="javascript 1.0.8",i.osVersionPair=i.matchItem([navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera].join(" "),[new n("windows_phone","Windows Phone","OS"),new n("windows","Win","NT"),new n("ios","iPhone","OS"),new n("ios","iPad","OS"),new n("ios","iPod","OS"),new n("android","Android","Android"),new n("blackBerry","BlackBerry","/"),new n("mac_osx","Mac","OS X"),new n("tizen","Tizen","Tizen"),new n("linux","Linux","rv")]),i.buildPlatform=i.runtimePlatformToString(),i.deviceModel=i.getDeviceModel(),i.deviceManufacturer=i.getDeviceManufacturer(),i.osVersion=i.getOSVersionString(),i.browserVersion=i.getBrowserVersionString(),i.maxSafeInteger=Math.pow(2,53)-1,e.GADevice=i}(n=e.device||(e.device={}))}(ga||(ga={}));var ga;!function(e){var n;!function(e){var n=function(){function e(n,t){this.deadline=n,this.block=t,this.ignore=!1,this.id=++e.idCounter}return e}();n.idCounter=0,e.TimedBlock=n}(n=e.threading||(e.threading={}))}(ga||(ga={}));var ga;!function(e){var n;!function(e){var n=function(){function e(e){this.comparer=e,this._subQueues={},this._sortedKeys=[]}return e.prototype.enqueue=function(e,n){this._sortedKeys.indexOf(e)===-1&&this.addQueueOfPriority(e),this._subQueues[e].push(n)},e.prototype.addQueueOfPriority=function(e){var n=this;this._sortedKeys.push(e),this._sortedKeys.sort(function(e,t){return n.comparer.compare(e,t)}),this._subQueues[e]=[]},e.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},e.prototype.hasItems=function(){return this._sortedKeys.length>0},e.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},e.prototype.dequeueFromHighPriorityQueue=function(){var e=this._sortedKeys[0],n=this._subQueues[e].shift();return 0===this._subQueues[e].length&&(this._sortedKeys.shift(),delete this._subQueues[e]),n},e}();e.PriorityQueue=n}(n=e.threading||(e.threading={}))}(ga||(ga={}));var ga;!function(e){var n;!function(n){var t,i=e.logging.GALogger;!function(e){e[e.Equal=0]="Equal",e[e.LessOrEqual=1]="LessOrEqual",e[e.NotEqual=2]="NotEqual"}(t=n.EGAStoreArgsOperator||(n.EGAStoreArgsOperator={}));var s;!function(e){e[e.Events=0]="Events",e[e.Sessions=1]="Sessions",e[e.Progression=2]="Progression"}(s=n.EGAStore||(n.EGAStore={}));var r=function(){function e(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"==typeof localStorage?(localStorage.setItem("testingLocalStorage","yes"),localStorage.removeItem("testingLocalStorage"),e.storageAvailable=!0):e.storageAvailable=!1}catch(e){}}return e.isStorageAvailable=function(){return e.storageAvailable},e.isStoreTooLargeForEvents=function(){return e.instance.eventsStore.length+e.instance.sessionsStore.length>e.MaxNumberOfEntries},e.select=function(n,i,s,r){void 0===i&&(i=[]),void 0===s&&(s=!1),void 0===r&&(r=0);var o=e.getStore(n);if(!o)return null;for(var a=[],u=0;u<o.length;++u){for(var c=o[u],d=!0,l=0;l<i.length;++l){var f=i[l];if(c[f[0]])switch(f[1]){case t.Equal:d=c[f[0]]==f[2];break;case t.LessOrEqual:d=c[f[0]]<=f[2];break;case t.NotEqual:d=c[f[0]]!=f[2];break;default:d=!1}else d=!1;if(!d)break}d&&a.push(c)}return s&&a.sort(function(e,n){return e.client_ts-n.client_ts}),r>0&&a.length>r&&(a=a.slice(0,r+1)),a},e.update=function(n,i,s){void 0===s&&(s=[]);var r=e.getStore(n);if(!r)return!1;for(var o=0;o<r.length;++o){for(var a=r[o],u=!0,c=0;c<s.length;++c){var d=s[c];if(a[d[0]])switch(d[1]){case t.Equal:u=a[d[0]]==d[2];break;case t.LessOrEqual:u=a[d[0]]<=d[2];break;case t.NotEqual:u=a[d[0]]!=d[2];break;default:u=!1}else u=!1;if(!u)break}if(u)for(var c=0;c<i.length;++c){var l=i[c];a[l[0]]=l[1]}}return!0},e.delete=function(n,i){var s=e.getStore(n);if(s)for(var r=0;r<s.length;++r){for(var o=s[r],a=!0,u=0;u<i.length;++u){var c=i[u];if(o[c[0]])switch(c[1]){case t.Equal:a=o[c[0]]==c[2];break;case t.LessOrEqual:a=o[c[0]]<=c[2];break;case t.NotEqual:a=o[c[0]]!=c[2];break;default:a=!1}else a=!1;if(!a)break}a&&(s.splice(r,1),--r)}},e.insert=function(n,t,i,s){void 0===i&&(i=!1),void 0===s&&(s=null);var r=e.getStore(n);if(r)if(i){if(!s)return;for(var o=!1,a=0;a<r.length;++a){var u=r[a];if(u[s]==t[s]){for(var c in t)u[c]=t[c];o=!0;break}}o||r.push(t)}else r.push(t)},e.save=function(){return e.isStorageAvailable()?(localStorage.setItem(e.KeyPrefix+e.EventsStoreKey,JSON.stringify(e.instance.eventsStore)),localStorage.setItem(e.KeyPrefix+e.SessionsStoreKey,JSON.stringify(e.instance.sessionsStore)),localStorage.setItem(e.KeyPrefix+e.ProgressionStoreKey,JSON.stringify(e.instance.progressionStore)),void localStorage.setItem(e.KeyPrefix+e.ItemsStoreKey,JSON.stringify(e.instance.storeItems))):void i.w("Storage is not available, cannot save.")},e.load=function(){if(!e.isStorageAvailable())return void i.w("Storage is not available, cannot load.");try{e.instance.eventsStore=JSON.parse(localStorage.getItem(e.KeyPrefix+e.EventsStoreKey)),e.instance.eventsStore||(e.instance.eventsStore=[])}catch(n){i.w("Load failed for 'events' store. Using empty store."),e.instance.eventsStore=[]}try{e.instance.sessionsStore=JSON.parse(localStorage.getItem(e.KeyPrefix+e.SessionsStoreKey)),e.instance.sessionsStore||(e.instance.sessionsStore=[])}catch(n){i.w("Load failed for 'sessions' store. Using empty store."),e.instance.sessionsStore=[]}try{e.instance.progressionStore=JSON.parse(localStorage.getItem(e.KeyPrefix+e.ProgressionStoreKey)),e.instance.progressionStore||(e.instance.progressionStore=[])}catch(n){i.w("Load failed for 'progression' store. Using empty store."),e.instance.progressionStore=[]}try{e.instance.storeItems=JSON.parse(localStorage.getItem(e.KeyPrefix+e.ItemsStoreKey)),e.instance.storeItems||(e.instance.storeItems={})}catch(n){i.w("Load failed for 'items' store. Using empty store."),e.instance.progressionStore=[]}},e.setItem=function(n,t){var i=e.KeyPrefix+n;t?e.instance.storeItems[i]=t:i in e.instance.storeItems&&delete e.instance.storeItems[i]},e.getItem=function(n){var t=e.KeyPrefix+n;return t in e.instance.storeItems?e.instance.storeItems[t]:null},e.getStore=function(n){switch(n){case s.Events:return e.instance.eventsStore;case s.Sessions:return e.instance.sessionsStore;case s.Progression:return e.instance.progressionStore;default:return i.w("GAStore.getStore(): Cannot find store: "+n),null}},e}();r.instance=new r,r.MaxNumberOfEntries=2e3,r.KeyPrefix="GA::",r.EventsStoreKey="ga_event",r.SessionsStoreKey="ga_session",r.ProgressionStoreKey="ga_progression",r.ItemsStoreKey="ga_items",n.GAStore=r}(n=e.store||(e.store={}))}(ga||(ga={}));var ga;!function(e){var n;!function(n){var t=e.validators.GAValidator,i=e.utilities.GAUtilities,s=e.logging.GALogger,r=e.store.GAStore,o=e.device.GADevice,a=e.store.EGAStore,u=e.store.EGAStoreArgsOperator,c=function(){function n(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={}}return n.setUserId=function(e){n.instance.userId=e,n.cacheIdentifier()},n.getIdentifier=function(){return n.instance.identifier},n.isInitialized=function(){return n.instance.initialized},n.setInitialized=function(e){n.instance.initialized=e},n.getSessionStart=function(){return n.instance.sessionStart},n.getSessionNum=function(){return n.instance.sessionNum},n.getTransactionNum=function(){return n.instance.transactionNum},n.getSessionId=function(){return n.instance.sessionId},n.getCurrentCustomDimension01=function(){return n.instance.currentCustomDimension01},n.getCurrentCustomDimension02=function(){return n.instance.currentCustomDimension02},n.getCurrentCustomDimension03=function(){return n.instance.currentCustomDimension03},n.getGameKey=function(){return n.instance.gameKey},n.getGameSecret=function(){return n.instance.gameSecret},n.getAvailableCustomDimensions01=function(){return n.instance.availableCustomDimensions01},n.setAvailableCustomDimensions01=function(e){t.validateCustomDimensions(e)&&(n.instance.availableCustomDimensions01=e,n.validateAndFixCurrentDimensions(),s.i("Set available custom01 dimension values: ("+i.joinStringArray(e,", ")+")"))},n.getAvailableCustomDimensions02=function(){return n.instance.availableCustomDimensions02},n.setAvailableCustomDimensions02=function(e){t.validateCustomDimensions(e)&&(n.instance.availableCustomDimensions02=e,n.validateAndFixCurrentDimensions(),s.i("Set available custom02 dimension values: ("+i.joinStringArray(e,", ")+")"))},n.getAvailableCustomDimensions03=function(){return n.instance.availableCustomDimensions03},n.setAvailableCustomDimensions03=function(e){t.validateCustomDimensions(e)&&(n.instance.availableCustomDimensions03=e,n.validateAndFixCurrentDimensions(),s.i("Set available custom03 dimension values: ("+i.joinStringArray(e,", ")+")"))},n.getAvailableResourceCurrencies=function(){return n.instance.availableResourceCurrencies},n.setAvailableResourceCurrencies=function(e){t.validateResourceCurrencies(e)&&(n.instance.availableResourceCurrencies=e,s.i("Set available resource currencies: ("+i.joinStringArray(e,", ")+")"))},n.getAvailableResourceItemTypes=function(){return n.instance.availableResourceItemTypes},n.setAvailableResourceItemTypes=function(e){t.validateResourceItemTypes(e)&&(n.instance.availableResourceItemTypes=e,s.i("Set available resource item types: ("+i.joinStringArray(e,", ")+")"))},n.getBuild=function(){return n.instance.build},n.setBuild=function(e){n.instance.build=e,s.i("Set build version: "+e)},n.getUseManualSessionHandling=function(){return n.instance.useManualSessionHandling},n.prototype.setDefaultId=function(e){this.defaultUserId=e?e:"",n.cacheIdentifier()},n.getDefaultId=function(){return n.instance.defaultUserId},n.getSdkConfig=function(){var e,t=0;for(var i in n.instance.sdkConfig)0===t&&(e=i),++t;if(e&&t>0)return n.instance.sdkConfig;var e,t=0;for(var i in n.instance.sdkConfigCached)0===t&&(e=i),++t;return e&&t>0?n.instance.sdkConfigCached:n.instance.sdkConfigDefault},n.isEnabled=function(){var e=n.getSdkConfig();return(!e.enabled||"false"!=e.enabled)&&!!n.instance.initAuthorized},n.setCustomDimension01=function(e){n.instance.currentCustomDimension01=e,r.setItem(n.Dimension01Key,e),s.i("Set custom01 dimension value: "+e)},n.setCustomDimension02=function(e){n.instance.currentCustomDimension02=e,r.setItem(n.Dimension02Key,e),s.i("Set custom02 dimension value: "+e)},n.setCustomDimension03=function(e){n.instance.currentCustomDimension03=e,r.setItem(n.Dimension03Key,e),s.i("Set custom03 dimension value: "+e)},n.setFacebookId=function(e){n.instance.facebookId=e,r.setItem(n.FacebookIdKey,e),s.i("Set facebook id: "+e)},n.setGender=function(t){n.instance.gender=e.EGAGender[t].toString().toLowerCase(),r.setItem(n.GenderKey,n.instance.gender),s.i("Set gender: "+n.instance.gender)},n.setBirthYear=function(e){n.instance.birthYear=e,r.setItem(n.BirthYearKey,e.toString()),s.i("Set birth year: "+e)},n.incrementSessionNum=function(){var e=n.getSessionNum()+1;n.instance.sessionNum=e},n.incrementTransactionNum=function(){var e=n.getTransactionNum()+1;n.instance.transactionNum=e},n.incrementProgressionTries=function(e){var t=n.getProgressionTries(e)+1;n.instance.progressionTries[e]=t;var i={};i.progression=e,i.tries=t,r.insert(a.Progression,i,!0,"progression")},n.getProgressionTries=function(e){return e in n.instance.progressionTries?n.instance.progressionTries[e]:0},n.clearProgressionTries=function(e){e in n.instance.progressionTries&&delete n.instance.progressionTries[e];var t=[];t.push(["progression",u.Equal,e]),r.delete(a.Progression,t)},n.setKeys=function(e,t){n.instance.gameKey=e,n.instance.gameSecret=t},n.setManualSessionHandling=function(e){n.instance.useManualSessionHandling=e,s.i("Use manual session handling: "+e)},n.getEventAnnotations=function(){var e={};e.v=2,e.user_id=n.instance.identifier,e.client_ts=n.getClientTsAdjusted(),e.sdk_version=o.getRelevantSdkVersion(),e.os_version=o.osVersion,e.manufacturer=o.deviceManufacturer,e.device=o.deviceModel,e.browser_version=o.browserVersion,e.platform=o.buildPlatform,e.session_id=n.instance.sessionId,e[n.SessionNumKey]=n.instance.sessionNum;var i=o.getConnectionType();return t.validateConnectionType(i)&&(e.connection_type=i),o.gameEngineVersion&&(e.engine_version=o.gameEngineVersion),n.instance.build&&(e.build=n.instance.build),n.instance.facebookId&&(e[n.FacebookIdKey]=n.instance.facebookId),n.instance.gender&&(e[n.GenderKey]=n.instance.gender),0!=n.instance.birthYear&&(e[n.BirthYearKey]=n.instance.birthYear),e},n.getSdkErrorEventAnnotations=function(){var e={};e.v=2,e.category=n.CategorySdkError,e.sdk_version=o.getRelevantSdkVersion(),e.os_version=o.osVersion,e.manufacturer=o.deviceManufacturer,e.device=o.deviceModel,e.platform=o.buildPlatform;var i=o.getConnectionType();return t.validateConnectionType(i)&&(e.connection_type=i),o.gameEngineVersion&&(e.engine_version=o.gameEngineVersion),e},n.getInitAnnotations=function(){var e={};return e.sdk_version=o.getRelevantSdkVersion(),e.os_version=o.osVersion,e.platform=o.buildPlatform,e},n.getClientTsAdjusted=function(){var e=i.timeIntervalSince1970(),s=e+n.instance.clientServerTimeOffset;return t.validateClientTs(s)?s:e},n.sessionIsStarted=function(){return 0!=n.instance.sessionStart},n.cacheIdentifier=function(){n.instance.userId?n.instance.identifier=n.instance.userId:n.instance.defaultUserId&&(n.instance.identifier=n.instance.defaultUserId)},n.ensurePersistedStates=function(){r.isStorageAvailable()&&r.load();var e=n.instance;e.setDefaultId(null!=r.getItem(n.DefaultUserIdKey)?r.getItem(n.DefaultUserIdKey):i.createGuid()),e.sessionNum=null!=r.getItem(n.SessionNumKey)?Number(r.getItem(n.SessionNumKey)):0,e.transactionNum=null!=r.getItem(n.TransactionNumKey)?Number(r.getItem(n.TransactionNumKey)):0,e.facebookId?r.setItem(n.FacebookIdKey,e.facebookId):(e.facebookId=null!=r.getItem(n.FacebookIdKey)?r.getItem(n.FacebookIdKey):"",e.facebookId),e.gender?r.setItem(n.GenderKey,e.gender):(e.gender=null!=r.getItem(n.GenderKey)?r.getItem(n.GenderKey):"",e.gender),e.birthYear&&0!=e.birthYear?r.setItem(n.BirthYearKey,e.birthYear.toString()):(e.birthYear=null!=r.getItem(n.BirthYearKey)?Number(r.getItem(n.BirthYearKey)):0,0!=e.birthYear),e.currentCustomDimension01?r.setItem(n.Dimension01Key,e.currentCustomDimension01):(e.currentCustomDimension01=null!=r.getItem(n.Dimension01Key)?r.getItem(n.Dimension01Key):"",e.currentCustomDimension01),e.currentCustomDimension02?r.setItem(n.Dimension02Key,e.currentCustomDimension02):(e.currentCustomDimension02=null!=r.getItem(n.Dimension02Key)?r.getItem(n.Dimension02Key):"",e.currentCustomDimension02),e.currentCustomDimension03?r.setItem(n.Dimension03Key,e.currentCustomDimension03):(e.currentCustomDimension03=null!=r.getItem(n.Dimension03Key)?r.getItem(n.Dimension03Key):"",e.currentCustomDimension03);var t=null!=r.getItem(n.SdkConfigCachedKey)?r.getItem(n.SdkConfigCachedKey):"";if(t){var s=JSON.parse(i.decode64(t));s&&(e.sdkConfigCached=s)}var o=r.select(a.Progression);if(o)for(var u=0;u<o.length;++u){var c=o[u];c&&(e.progressionTries[c.progression]=c.tries)}},n.calculateServerTimeOffset=function(e){var n=i.timeIntervalSince1970();return e-n},n.validateAndFixCurrentDimensions=function(){t.validateDimension01(n.getCurrentCustomDimension01(),n.getAvailableCustomDimensions01())||n.setCustomDimension01(""),t.validateDimension02(n.getCurrentCustomDimension02(),n.getAvailableCustomDimensions02())||n.setCustomDimension02(""),t.validateDimension03(n.getCurrentCustomDimension03(),n.getAvailableCustomDimensions03())||n.setCustomDimension03("")},n}();c.CategorySdkError="sdk_error",c.instance=new c,c.DefaultUserIdKey="default_user_id",c.SessionNumKey="session_num",c.TransactionNumKey="transaction_num",c.FacebookIdKey="facebook_id",c.GenderKey="gender",c.BirthYearKey="birth_year",c.Dimension01Key="dimension01",c.Dimension02Key="dimension02",c.Dimension03Key="dimension03",c.SdkConfigCachedKey="sdk_config_cached",n.GAState=c}(n=e.state||(e.state={}))}(ga||(ga={}));var ga;!function(e){var n;!function(n){var t=e.utilities.GAUtilities,i=e.logging.GALogger,s=function(){function e(){}return e.execute=function(n,s,r,o){if(e.countMap[s]||(e.countMap[s]=0),!(e.countMap[s]>=e.MaxCount)){var a=t.getHmac(o,r),u=new XMLHttpRequest;u.onreadystatechange=function(){if(4===u.readyState){if(!u.responseText)return;if(200!=u.status)return void i.w("sdk error failed. response code not 200. status code: "+u.status+", description: "+u.statusText+", body: "+u.responseText);e.countMap[s]=e.countMap[s]+1}},u.open("POST",n,!0),u.setRequestHeader("Content-Type","application/json"),u.setRequestHeader("Authorization",a);try{u.send(r)}catch(e){console.error(e)}}},e}();s.MaxCount=10,s.countMap={},n.SdkErrorTask=s}(n=e.tasks||(e.tasks={}))}(ga||(ga={}));var ga;!function(e){var n;!function(n){var t=e.state.GAState,i=e.logging.GALogger,s=e.utilities.GAUtilities,r=e.validators.GAValidator,o=e.tasks.SdkErrorTask,a=function(){function e(){this.protocol="https",this.hostName="api.gameanalytics.com",this.version="v2",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}return e.prototype.requestInit=function(i){var s=t.getGameKey(),r=this.baseUrl+"/"+s+"/"+this.initializeUrlPath,o=t.getInitAnnotations(),a=JSON.stringify(o);if(!a)return void i(n.EGAHTTPApiResponse.JsonEncodeFailed,null);var u=this.createPayloadData(a,this.useGzip),c=[];c.push(a),e.sendRequest(r,u,c,this.useGzip,e.initRequestCallback,i)},e.prototype.sendEventsInArray=function(i,s,r){0==i.length;var o=t.getGameKey(),a=this.baseUrl+"/"+o+"/"+this.eventsUrlPath,u=JSON.stringify(i);if(!u)return void r(n.EGAHTTPApiResponse.JsonEncodeFailed,null,s,i.length);var c=this.createPayloadData(u,this.useGzip),d=[];d.push(u),d.push(s),d.push(i.length.toString()),e.sendRequest(a,c,d,this.useGzip,e.sendEventInArrayRequestCallback,r)},e.prototype.sendSdkErrorEvent=function(n){var s=t.getGameKey(),a=t.getGameSecret();if(r.validateSdkErrorEvent(s,a,n)){var u=this.baseUrl+"/"+s+"/"+this.eventsUrlPath,c="",d=t.getSdkErrorEventAnnotations(),l=e.sdkErrorTypeToString(n);d.type=l;var f=[];return f.push(d),(c=JSON.stringify(f))?void o.execute(u,n,c,a):void i.w("sendSdkErrorEvent: JSON encoding failed.");
}},e.sendEventInArrayRequestCallback=function(t,i,s,r){void 0===r&&(r=null);var o=(r[0],r[1],r[2]),a=parseInt(r[3]),u="",c=0;u=t.responseText,c=t.status;var d=e.instance.processRequestResponse(c,t.statusText,u,"Events");if(d!=n.EGAHTTPApiResponse.Ok&&d!=n.EGAHTTPApiResponse.BadRequest)return void s(d,null,o,a);var l=u?JSON.parse(u):{};return null==l?void s(n.EGAHTTPApiResponse.JsonDecodeFailed,null,o,a):(d==n.EGAHTTPApiResponse.BadRequest,void s(d,l,o,a))},e.sendRequest=function(e,n,i,r,o,a){var u=new XMLHttpRequest,c=t.getGameSecret(),d=s.getHmac(c,n),l=[];l.push(d);for(var f in i)l.push(i[f]);if(u.onreadystatechange=function(){4===u.readyState&&o(u,e,a,l)},u.open("POST",e,!0),u.setRequestHeader("Content-Type","application/json"),u.setRequestHeader("Authorization",d),r)throw new Error("gzip not supported");try{u.send(n)}catch(e){console.error(e.stack)}},e.initRequestCallback=function(t,i,s,o){void 0===o&&(o=null);var a=(o[0],o[1],""),u=0;a=t.responseText,u=t.status;var c=a?JSON.parse(a):{},d=e.instance.processRequestResponse(u,t.statusText,a,"Init");if(d!=n.EGAHTTPApiResponse.Ok&&d!=n.EGAHTTPApiResponse.BadRequest)return void s(d,null);if(null==c)return void s(n.EGAHTTPApiResponse.JsonDecodeFailed,null);if(d===n.EGAHTTPApiResponse.BadRequest)return void s(d,null);var l=r.validateAndCleanInitRequestResponse(c);return l?void s(n.EGAHTTPApiResponse.Ok,l):void s(n.EGAHTTPApiResponse.BadResponse,null)},e.prototype.createPayloadData=function(e,n){var t;if(n)throw new Error("gzip not supported");return t=e},e.prototype.processRequestResponse=function(e,t,i,s){return i?200===e?n.EGAHTTPApiResponse.Ok:0===e||401===e?n.EGAHTTPApiResponse.Unauthorized:400===e?n.EGAHTTPApiResponse.BadRequest:500===e?n.EGAHTTPApiResponse.InternalServerError:n.EGAHTTPApiResponse.UnknownResponseCode:n.EGAHTTPApiResponse.NoResponse},e.sdkErrorTypeToString=function(e){switch(e){case n.EGASdkErrorType.Rejected:return"rejected";default:return""}},e}();a.instance=new a,n.GAHTTPApi=a}(n=e.http||(e.http={}))}(ga||(ga={}));var ga;!function(e){var n;!function(n){var t=e.store.GAStore,i=e.store.EGAStore,s=e.store.EGAStoreArgsOperator,r=e.state.GAState,o=e.logging.GALogger,a=e.utilities.GAUtilities,u=e.http.EGAHTTPApiResponse,c=e.http.GAHTTPApi,d=e.validators.GAValidator,l=e.http.EGASdkErrorType,f=function(){function n(){}return n.addSessionStartEvent=function(){var e={};e.category=n.CategorySessionStart,r.incrementSessionNum(),t.setItem(r.SessionNumKey,r.getSessionNum().toString()),n.addDimensionsToEvent(e),n.addEventToStore(e),o.i("Add SESSION START event"),n.processEvents(n.CategorySessionStart,!1)},n.addSessionEndEvent=function(){var e=r.getSessionStart(),t=r.getClientTsAdjusted(),i=t-e;i<0&&(o.w("Session length was calculated to be less then 0. Should not be possible. Resetting to 0."),i=0);var s={};s.category=n.CategorySessionEnd,s.length=i,n.addDimensionsToEvent(s),n.addEventToStore(s),o.i("Add SESSION END event."),n.processEvents("",!1)},n.addBusinessEvent=function(e,i,s,a,u){if(void 0===u&&(u=null),!d.validateBusinessEvent(e,i,u,s,a))return void c.instance.sendSdkErrorEvent(l.Rejected);var f={};r.incrementTransactionNum(),t.setItem(r.TransactionNumKey,r.getTransactionNum().toString()),f.event_id=s+":"+a,f.category=n.CategoryBusiness,f.currency=e,f.amount=i,f[r.TransactionNumKey]=r.getTransactionNum(),u&&(f.cart_type=u),n.addDimensionsToEvent(f),o.i("Add BUSINESS event: {currency:"+e+", amount:"+i+", itemType:"+s+", itemId:"+a+", cartType:"+u+"}"),n.addEventToStore(f)},n.addResourceEvent=function(t,i,s,a,u){if(!d.validateResourceEvent(t,i,s,a,u,r.getAvailableResourceCurrencies(),r.getAvailableResourceItemTypes()))return void c.instance.sendSdkErrorEvent(l.Rejected);t===e.EGAResourceFlowType.Sink&&(s*=-1);var f={},v=n.resourceFlowTypeToString(t);f.event_id=v+":"+i+":"+a+":"+u,f.category=n.CategoryResource,f.amount=s,n.addDimensionsToEvent(f),o.i("Add RESOURCE event: {currency:"+i+", amount:"+s+", itemType:"+a+", itemId:"+u+"}"),n.addEventToStore(f)},n.addProgressionEvent=function(t,i,s,a,u,f){var v=n.progressionStatusToString(t);if(!d.validateProgressionEvent(t,i,s,a))return void c.instance.sendSdkErrorEvent(l.Rejected);var g,m={};g=s?a?i+":"+s+":"+a:i+":"+s:i,m.category=n.CategoryProgression,m.event_id=v+":"+g;var p=0;f&&t!=e.EGAProgressionStatus.Start&&(m.score=u),t===e.EGAProgressionStatus.Fail&&r.incrementProgressionTries(g),t===e.EGAProgressionStatus.Complete&&(r.incrementProgressionTries(g),p=r.getProgressionTries(g),m.attempt_num=p,r.clearProgressionTries(g)),n.addDimensionsToEvent(m),o.i("Add PROGRESSION event: {status:"+v+", progression01:"+i+", progression02:"+s+", progression03:"+a+", score:"+u+", attempt:"+p+"}"),n.addEventToStore(m)},n.addDesignEvent=function(e,t,i){if(!d.validateDesignEvent(e,t))return void c.instance.sendSdkErrorEvent(l.Rejected);var s={};s.category=n.CategoryDesign,s.event_id=e,i&&(s.value=t),o.i("Add DESIGN event: {eventId:"+e+", value:"+t+"}"),n.addEventToStore(s)},n.addErrorEvent=function(e,t){var i=n.errorSeverityToString(e);if(!d.validateErrorEvent(e,t))return void c.instance.sendSdkErrorEvent(l.Rejected);var s={};s.category=n.CategoryError,s.severity=i,s.message=t,o.i("Add ERROR event: {severity:"+i+", message:"+t+"}"),n.addEventToStore(s)},n.processEvents=function(e,r){try{var u=a.createGuid();r&&(n.cleanupEvents(),n.fixMissingSessionEndEvents());var d=[];d.push(["status",s.Equal,"new"]);var l=[];l.push(["status",s.Equal,"new"]),e&&(d.push(["category",s.Equal,e]),l.push(["category",s.Equal,e]));var f=[];f.push(["status",u]);var v=t.select(i.Events,d);if(!v)return void o.i("Event queue: No events to send");if(v.length>n.MaxEventCount){if(v=t.select(i.Events,d,!0,n.MaxEventCount),!v)return;var g=v[v.length-1],m=g.client_ts;if(d.push(["client_ts",s.LessOrEqual,m]),v=t.select(i.Events,d),!v)return;l.push(["client_ts",s.LessOrEqual,m])}if(o.i("Event queue: Sending "+v.length+" events."),!t.update(i.Events,f,l))return;for(var p=[],S=0;S<v.length;++S){var h=v[S],y=JSON.parse(a.decode64(h.event));0!=y.length&&p.push(y)}c.instance.sendEventsInArray(p,u,n.processEventsCallback)}catch(e){o.e("Error during ProcessEvents(): "+e.stack)}},n.processEventsCallback=function(e,r,a,c){var d=[];if(d.push(["status",s.Equal,a]),e===u.Ok)t.delete(i.Events,d),o.i("Event queue: "+c+" events sent.");else if(e===u.NoResponse){var l=[];l.push(["status","new"]),o.w("Event queue: Failed to send events to collector - Retrying next time"),t.update(i.Events,l,d)}else{if(r){var f,v=0;for(var g in r)0==v&&(f=r[g]),++v;e===u.BadRequest&&f.constructor===Array?o.w("Event queue: "+c+" events sent. "+v+" events failed GA server validation."):o.w("Event queue: Failed to send events.")}else o.w("Event queue: Failed to send events.");t.delete(i.Events,d)}n.updateSessionStore()},n.cleanupEvents=function(){t.update(i.Events,[["status","new"]])},n.fixMissingSessionEndEvents=function(){var e=[];e.push(["session_id",s.NotEqual,r.getSessionId()]);var u=t.select(i.Sessions,e);if(u&&0!=u.length){o.i(u.length+" session(s) located with missing session_end event.");for(var c=0;c<u.length;++c){var d=JSON.parse(a.decode64(u[c].event)),l=d.client_ts,f=u[c].timestamp,v=l-f;v=Math.max(0,v),d.category=n.CategorySessionEnd,d.length=v,n.addEventToStore(d)}}},n.addEventToStore=function(e){if(!r.isInitialized())return void o.w("Could not add event: SDK is not initialized");try{if(t.isStoreTooLargeForEvents()&&!a.stringMatch(e.category,/^(user|session_end|business)$/))return void o.w("Database too large. Event has been blocked.");var u=r.getEventAnnotations(),c=a.encode64(JSON.stringify(u));for(var d in e)u[d]=e[d];var l=JSON.stringify(u);o.ii("Event added to queue: "+l);var f={};f.status="new",f.category=u.category,f.session_id=u.session_id,f.client_ts=u.client_ts,f.event=a.encode64(JSON.stringify(u)),t.insert(i.Events,f),e.category==n.CategorySessionEnd?t.delete(i.Sessions,[["session_id",s.Equal,u.session_id]]):(f={},f.session_id=u.session_id,f.timestamp=r.getSessionStart(),f.event=c,t.insert(i.Sessions,f,!0,"session_id")),t.isStorageAvailable()&&t.save()}catch(e){o.e("addEventToStore: error"),o.e(e.stack)}},n.updateSessionStore=function(){var e={};e.session_id=r.instance.sessionId,e.timestamp=r.getSessionStart(),e.event=a.encode64(JSON.stringify(r.getEventAnnotations())),t.insert(i.Sessions,e,!0,"session_id"),t.isStorageAvailable()&&t.save()},n.addDimensionsToEvent=function(e){e&&(r.getCurrentCustomDimension01()&&(e.custom_01=r.getCurrentCustomDimension01()),r.getCurrentCustomDimension02()&&(e.custom_02=r.getCurrentCustomDimension02()),r.getCurrentCustomDimension03()&&(e.custom_03=r.getCurrentCustomDimension03()))},n.resourceFlowTypeToString=function(n){switch(n){case e.EGAResourceFlowType.Source:return"Source";case e.EGAResourceFlowType.Sink:return"Sink";default:return""}},n.progressionStatusToString=function(n){switch(n){case e.EGAProgressionStatus.Start:return"Start";case e.EGAProgressionStatus.Complete:return"Complete";case e.EGAProgressionStatus.Fail:return"Fail";default:return""}},n.errorSeverityToString=function(n){switch(n){case e.EGAErrorSeverity.Debug:return"debug";case e.EGAErrorSeverity.Info:return"info";case e.EGAErrorSeverity.Warning:return"warning";case e.EGAErrorSeverity.Error:return"error";case e.EGAErrorSeverity.Critical:return"critical";default:return""}},n}();f.instance=new f,f.CategorySessionStart="user",f.CategorySessionEnd="session_end",f.CategoryDesign="design",f.CategoryBusiness="business",f.CategoryProgression="progression",f.CategoryResource="resource",f.CategoryError="error",f.MaxEventCount=500,n.GAEvents=f}(n=e.events||(e.events={}))}(ga||(ga={}));var ga;!function(e){var n;!function(n){var t=e.logging.GALogger,i=e.state.GAState,s=e.events.GAEvents,r=function(){function e(){this.blocks=new n.PriorityQueue({compare:function(e,n){return e-n}}),this.id2TimedBlockMap={},e.startThread()}return e.performTaskOnGAThread=function(t,i){void 0===i&&(i=0);var s=new Date;s.setSeconds(s.getSeconds()+i);var r=new n.TimedBlock(s,t);e.instance.id2TimedBlockMap[r.id]=r,e.instance.addTimedBlock(r)},e.scheduleTimer=function(t,i){var s=new Date;s.setSeconds(s.getSeconds()+t);var r=new n.TimedBlock(s,i);return e.instance.id2TimedBlockMap[r.id]=r,e.instance.addTimedBlock(r),r.id},e.ensureEventQueueIsRunning=function(){e.instance.keepRunning=!0,e.instance.isRunning||(e.instance.isRunning=!0,e.scheduleTimer(e.ProcessEventsIntervalInSeconds,e.processEventQueue))},e.endSessionAndStopQueue=function(){i.isInitialized()&&(t.i("Ending session."),e.stopEventQueue(),i.isEnabled()&&i.sessionIsStarted()&&(s.addSessionEndEvent(),i.instance.sessionStart=0))},e.stopEventQueue=function(){e.instance.keepRunning=!1},e.ignoreTimer=function(n){n in e.instance.id2TimedBlockMap&&(e.instance.id2TimedBlockMap[n].ignore=!0)},e.prototype.addTimedBlock=function(e){this.blocks.enqueue(e.deadline.getTime(),e)},e.run=function(){clearTimeout(e.runTimeoutId);try{for(var n;n=e.getNextBlock();)n.ignore||n.block();return void(e.runTimeoutId=setTimeout(e.run,e.ThreadWaitTimeInMs))}catch(e){t.e("Error on GA thread"),t.e(e.stack)}},e.startThread=function(){e.runTimeoutId=setTimeout(e.run,0)},e.getNextBlock=function(){var n=new Date;return e.instance.blocks.hasItems()&&e.instance.blocks.peek().deadline.getTime()<=n.getTime()?e.instance.blocks.dequeue():null},e.processEventQueue=function(){s.processEvents("",!0),e.instance.keepRunning?e.scheduleTimer(e.ProcessEventsIntervalInSeconds,e.processEventQueue):e.instance.isRunning=!1},e}();r.instance=new r,r.ThreadWaitTimeInMs=1e3,r.ProcessEventsIntervalInSeconds=8,n.GAThreading=r}(n=e.threading||(e.threading={}))}(ga||(ga={}));var ga;!function(e){var n=e.threading.GAThreading,t=e.logging.GALogger,i=e.store.GAStore,s=e.state.GAState,r=e.http.GAHTTPApi,o=e.device.GADevice,a=e.validators.GAValidator,u=e.http.EGAHTTPApiResponse,c=e.utilities.GAUtilities,d=e.events.GAEvents,l=function(){function l(){}return l.init=function(){o.touch()},l.configureAvailableCustomDimensions01=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){return l.isSdkReady(!0,!1)?void t.w("Available custom dimensions must be set before SDK is initialized"):void s.setAvailableCustomDimensions01(e)})},l.configureAvailableCustomDimensions02=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){return l.isSdkReady(!0,!1)?void t.w("Available custom dimensions must be set before SDK is initialized"):void s.setAvailableCustomDimensions02(e)})},l.configureAvailableCustomDimensions03=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){return l.isSdkReady(!0,!1)?void t.w("Available custom dimensions must be set before SDK is initialized"):void s.setAvailableCustomDimensions03(e)})},l.configureAvailableResourceCurrencies=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){return l.isSdkReady(!0,!1)?void t.w("Available resource currencies must be set before SDK is initialized"):void s.setAvailableResourceCurrencies(e)})},l.configureAvailableResourceItemTypes=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){return l.isSdkReady(!0,!1)?void t.w("Available resource item types must be set before SDK is initialized"):void s.setAvailableResourceItemTypes(e)})},l.configureBuild=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){return l.isSdkReady(!0,!1)?void t.w("Build version must be set before SDK is initialized."):a.validateBuild(e)?void s.setBuild(e):void t.i("Validation fail - configure build: Cannot be null, empty or above 32 length. String: "+e)})},l.configureSdkGameEngineVersion=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){if(!l.isSdkReady(!0,!1))return a.validateSdkWrapperVersion(e)?void(o.sdkGameEngineVersion=e):void t.i("Validation fail - configure sdk version: Sdk version not supported. String: "+e)})},l.configureGameEngineVersion=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){if(!l.isSdkReady(!0,!1))return a.validateEngineVersion(e)?void(o.gameEngineVersion=e):void t.i("Validation fail - configure game engine version: Game engine version not supported. String: "+e)})},l.configureUserId=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){return l.isSdkReady(!0,!1)?void t.w("A custom user id must be set before SDK is initialized."):a.validateUserId(e)?void s.setUserId(e):void t.i("Validation fail - configure user_id: Cannot be null, empty or above 64 length. Will use default user_id method. Used string: "+e)})},l.initialize=function(e,i){void 0===e&&(e=""),void 0===i&&(i=""),o.updateConnectionType(),n.performTaskOnGAThread(function(){return l.isSdkReady(!0,!1)?void t.w("SDK already initialized. Can only be called once."):a.validateKeys(e,i)?(s.setKeys(e,i),void l.internalInitialize()):void t.w("SDK failed initialize. Game key or secret key is invalid. Can only contain characters A-z 0-9, gameKey is 32 length, gameSecret is 40 length. Failed keys - gameKey: "+e+", secretKey: "+i)})},l.addBusinessEvent=function(e,t,i,s,r){void 0===e&&(e=""),void 0===t&&(t=0),void 0===i&&(i=""),void 0===s&&(s=""),void 0===r&&(r=""),o.updateConnectionType(),n.performTaskOnGAThread(function(){l.isSdkReady(!0,!0,"Could not add business event")&&d.addBusinessEvent(e,t,i,s,r)})},l.addResourceEvent=function(t,i,s,r,a){void 0===t&&(t=e.EGAResourceFlowType.Undefined),void 0===i&&(i=""),void 0===s&&(s=0),void 0===r&&(r=""),void 0===a&&(a=""),o.updateConnectionType(),n.performTaskOnGAThread(function(){l.isSdkReady(!0,!0,"Could not add resource event")&&d.addResourceEvent(t,i,s,r,a)})},l.addProgressionEvent=function(t,i,s,r,a){void 0===t&&(t=e.EGAProgressionStatus.Undefined),void 0===i&&(i=""),void 0===s&&(s=""),void 0===r&&(r=""),o.updateConnectionType(),n.performTaskOnGAThread(function(){if(l.isSdkReady(!0,!0,"Could not add progression event")){var e="undefined"!=typeof a;d.addProgressionEvent(t,i,s,r,e?a:0,e)}})},l.addDesignEvent=function(e,t){o.updateConnectionType(),n.performTaskOnGAThread(function(){if(l.isSdkReady(!0,!0,"Could not add design event")){var n="undefined"!=typeof t;d.addDesignEvent(e,n?t:0,n)}})},l.addErrorEvent=function(t,i){void 0===t&&(t=e.EGAErrorSeverity.Undefined),void 0===i&&(i=""),o.updateConnectionType(),n.performTaskOnGAThread(function(){l.isSdkReady(!0,!0,"Could not add error event")&&d.addErrorEvent(t,i)})},l.setEnabledInfoLog=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){e?(t.setInfoLog(e),t.i("Info logging enabled")):(t.i("Info logging disabled"),t.setInfoLog(e))})},l.setEnabledVerboseLog=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){e?(t.setVerboseLog(e),t.i("Verbose logging enabled")):(t.i("Verbose logging disabled"),t.setVerboseLog(e))})},l.setEnabledManualSessionHandling=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){s.setManualSessionHandling(e)})},l.setCustomDimension01=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){return a.validateDimension01(e,s.getAvailableCustomDimensions01())?void s.setCustomDimension01(e):void t.w("Could not set custom01 dimension value to '"+e+"'. Value not found in available custom01 dimension values")})},l.setCustomDimension02=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){return a.validateDimension02(e,s.getAvailableCustomDimensions02())?void s.setCustomDimension02(e):void t.w("Could not set custom02 dimension value to '"+e+"'. Value not found in available custom02 dimension values")})},l.setCustomDimension03=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){return a.validateDimension03(e,s.getAvailableCustomDimensions03())?void s.setCustomDimension03(e):void t.w("Could not set custom03 dimension value to '"+e+"'. Value not found in available custom03 dimension values")})},l.setFacebookId=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){a.validateFacebookId(e)&&s.setFacebookId(e)})},l.setGender=function(t){void 0===t&&(t=e.EGAGender.Undefined),n.performTaskOnGAThread(function(){a.validateGender(t)&&s.setGender(t)})},l.setBirthYear=function(e){void 0===e&&(e=0),n.performTaskOnGAThread(function(){a.validateBirthyear(e)&&s.setBirthYear(e)})},l.startSession=function(){n.performTaskOnGAThread(function(){if(s.getUseManualSessionHandling()){if(!s.isInitialized())return;s.isEnabled()&&s.sessionIsStarted()&&n.endSessionAndStopQueue(),l.resumeSessionAndStartQueue()}})},l.endSession=function(){s.getUseManualSessionHandling()&&l.onStop()},l.onStop=function(){try{n.endSessionAndStopQueue()}catch(e){}},l.onResume=function(){l.resumeSessionAndStartQueue()},l.internalInitialize=function(){s.ensurePersistedStates(),i.setItem(s.DefaultUserIdKey,s.getDefaultId()),s.setInitialized(!0),l.newSession(),s.isEnabled()&&n.ensureEventQueueIsRunning()},l.newSession=function(){t.i("Starting a new session."),s.validateAndFixCurrentDimensions(),r.instance.requestInit(l.startNewSessionCallback)},l.startNewSessionCallback=function(e,r){if(e===u.Ok&&r){var o=0;if(r.server_ts){var a=r.server_ts;o=s.calculateServerTimeOffset(a)}r.time_offset=o,i.setItem(s.SdkConfigCachedKey,c.encode64(JSON.stringify(r))),s.instance.sdkConfigCached=r,s.instance.sdkConfig=r,s.instance.initAuthorized=!0}else e==u.Unauthorized?(t.w("Initialize SDK failed - Unauthorized"),s.instance.initAuthorized=!1):(e===u.NoResponse||e===u.RequestTimeout?t.i("Init call (session start) failed - no response. Could be offline or timeout."):e===u.BadResponse||e===u.JsonEncodeFailed||e===u.JsonDecodeFailed?t.i("Init call (session start) failed - bad response. Could be bad response from proxy or GA servers."):e!==u.BadRequest&&e!==u.UnknownResponseCode||t.i("Init call (session start) failed - bad request or unknown response."),null==s.instance.sdkConfig?null!=s.instance.sdkConfigCached?(t.i("Init call (session start) failed - using cached init values."),s.instance.sdkConfig=s.instance.sdkConfigCached):(t.i("Init call (session start) failed - using default init values."),s.instance.sdkConfig=s.instance.sdkConfigDefault):t.i("Init call (session start) failed - using cached init values."),s.instance.initAuthorized=!0);if(s.instance.clientServerTimeOffset=s.instance.sdkConfig.time_offset?s.instance.sdkConfig.time_offset:0,!s.isEnabled())return t.w("Could not start session: SDK is disabled."),void n.stopEventQueue();n.ensureEventQueueIsRunning();var l=c.createGuid();s.instance.sessionId=l,s.instance.sessionStart=s.getClientTsAdjusted(),d.addSessionStartEvent()},l.resumeSessionAndStartQueue=function(){s.isInitialized()&&(t.i("Resuming session."),s.sessionIsStarted()||l.newSession())},l.isSdkReady=function(e,n,i){return void 0===n&&(n=!0),void 0===i&&(i=""),i&&(i+=": "),e&&!s.isInitialized()?(n&&t.w(i+"SDK is not initialized"),!1):!(e&&!s.isEnabled())||(n&&t.w(i+"SDK is disabled"),!1)},l}();e.GameAnalytics=l,l.init()}(ga||(ga={}));